import OpenAI from "openai";

const openai = new OpenAI({
  apiKey: process.env.OPENAI_API_KEY,
});

const response = await openai.chat.completions.create({
  model: "gpt-3.5-turbo",
  messages: [
    {
      "role": "system",
      "content": "You are a natural language processing expert.\\nYou are given a chapter from a book and only know the content from that chapter. \\nFor every character mentioned in the chapter you count everytime they are mentioned in the text by counting the number of words before the character appearance. You also count the character appearance  when the character is mentioned by personal pronounce. \\nYou output the the result of character occurence in the chapter is in json format as following:\n[\n{name: , \noccurence: [10, 15, 70, 105, 356, ...]\n},\n...\n]\nThe result in json format contains at most 5 characters, which are those that are mentioned the most.\nIn the end you output the total length of the chapter."
    },
    {
      "role": "user",
      "content": " <p class=\"p1\">\n          <span class=\"char-style-override-1\">N</span> the year 1878 I took my\n          degree of Doctor of Medicine of the University of London, and\n          proceeded to Netley to go through the course prescribed for surgeons\n          in the army. Having completed my studies there, I was duly attached to\n          the Fifth Northumberland Fusiliers as Assistant Surgeon. The regiment\n          was stationed in India at the time, and before I could join it, the\n          second Afghan war had broken out. On landing at Bombay, I learned that\n          my corps had advanced through the passes, and was already deep in the\n          enemy’s country. I followed, however, with many other officers who\n          were in the same situation as myself, and succeeded in reaching\n          Candahar in safety, where I found my regiment, and at once entered\n          upon my new duties.\n        </p>\n\n        <p class=\"p\">\n          The campaign brought honours and promotion to many, but for me it had\n          nothing but misfortune and disaster. I was removed from my brigade and\n          attached to the Berkshires, with whom I served at the fatal battle of\n          Maiwand. There I was struck on the shoulder by a Jezail bullet, which\n          shattered the bone and grazed the subclavian artery. I should have\n          fallen into the hands of the murderous Ghazis had it not been for the\n          devotion and courage shown by Murray, my orderly, who threw me across\n          a pack-horse, and succeeded in bringing me safely to the British\n          lines.\n        </p>\n\n        <p class=\"p\">\n          Worn with pain, and weak from the prolonged hardships which I had\n          undergone, I was removed, with a great train of wounded sufferers, to\n          the base hospital at Peshawur. Here I rallied, and had already\n          improved so far as to be able to walk about the wards, and even to\n          bask a little upon the verandah, when I was struck down by enteric\n          fever, that curse of our Indian possessions. For months my life was\n          despaired of, and when at last I came to myself and became\n          convalescent, I was so weak and emaciated that a medical board\n          determined that not a day should be lost in sending me back to\n          England. I was dispatched, accordingly, in the troopship Orontes, and\n          landed a month later on Portsmouth jetty, with my health irretrievably\n          ruined, but with permission from a paternal government to spend the\n          next nine months in attempting to improve it.\n        </p>\n\n        <p class=\"p\">\n          I had neither kith nor kin in England, and was therefore as free as\n          air — or as free as an income of eleven shillings and sixpence a day\n          will permit a man to be. Under such circumstances, I naturally\n          gravitated to London, that great cesspool into which all the loungers\n          and idlers of the Empire are irresistibly drained. There I stayed for\n          some time at a private hotel in the Strand, leading a comfortless,\n          meaningless existence, and spending such money as I had, considerably\n          more freely than I ought. So alarming did the state of my finances\n          become, that I soon realized that I must either leave the metropolis\n          and rusticate somewhere in the country, or that I must make a complete\n          alteration in my style of living. Choosing the latter alternative, I\n          began by making up my mind to leave the hotel, and to take up my\n          quarters in some less pretentious and less expensive domicile.\n        </p>\n\n        <p class=\"p\">\n          On the very day that I had come to this conclusion, I was standing at\n          the Criterion Bar, when someone tapped me on the shoulder, and turning\n          round I recognized young Stamford, who had been a dresser under me at\n          Bart’s. The sight of a friendly face in the great wilderness of London\n          is a pleasant thing indeed to a lonely man. In old days Stamford had\n          never been a particular crony of mine, but now I hailed him with\n          enthusiasm, and he, in his turn, appeared to be delighted to see me.\n          In the exuberance of my joy, I asked him to lunch with me at the\n          Holborn, and we started off together in a hansom.\n        </p>\n\n        <p class=\"p\">\n          “Whatever have you been doing with yourself, Watson?” he asked in\n          undisguised wonder, as we rattled through the crowded London streets.\n          “You are as thin as a lath and as brown as a nut.”\n        </p>\n\n        <p class=\"p\">\n          I gave him a short sketch of my adventures, and had hardly concluded\n          it by the time that we reached our destination.\n        </p>\n\n        <p class=\"p\">\n          “Poor devil!” he said, commiseratingly, after he had listened to my\n          misfortunes. “What are you up to now?”\n        </p>\n\n        <p class=\"p\">\n          “Looking for lodgings,” I answered. “trying to solve the problem as to\n          whether it is possible to get comfortable rooms at a reasonable\n          price.”\n        </p>\n\n        <p class=\"p\">\n          “That’s a strange thing,” remarked my companion; “you are the second\n          man to-day that has used that expression to me.”\n        </p>\n\n        <p class=\"p\">“And who was the first?” I asked.</p>\n\n        <p class=\"p\">\n          “A fellow who is working at the chemical laboratory up at the\n          hospital. He was bemoaning himself this morning because he could not\n          get someone to go halves with him in some nice rooms which he had\n          found, and which were too much for his purse.”\n        </p>\n\n        <p class=\"p\">\n          “By Jove!” I cried, “if he really wants someone to share the rooms and\n          the expense, I am the very man for him. I should prefer having a\n          partner to being alone.”\n        </p>\n\n        <p class=\"p\">\n          Young Stamford looked rather strangely at me over his wine-glass. “You\n          don’t know Sherlock Holmes yet,” he said; “perhaps you would not care\n          for him as a constant companion.”\n        </p>\n\n        <p class=\"p\">“Why, what is there against him?”</p>\n\n        <p class=\"p\">\n          “Oh, I didn’t say there was anything against him. He is a little queer\n          in his ideas — an enthusiast in some branches of science. As far as I\n          know he is a decent fellow enough.”\n        </p>\n\n        <p class=\"p\">“A medical student, I suppose?” said I.</p>\n\n        <p class=\"p\">\n          “No — I have no idea what he intends to go in for. I believe he is\n          well up in anatomy, and he is a first-class chemist; but, as far as I\n          know, he has never taken out any systematic medical classes. His\n          studies are very desultory and eccentric, but he has amassed a lot of\n          out-of-the way knowledge which would astonish his professors.”\n        </p>\n\n        <p class=\"p\">\n          “Did you never ask him what he was going in for?” I asked.\n        </p>\n\n        <p class=\"p\">\n          “No; he is not a man that it is easy to draw out, though he can be\n          communicative enough when the fancy seizes him.”\n        </p>\n\n        <p class=\"p\">\n          “I should like to meet him,” I said. “If I am to lodge with anyone, I\n          should prefer a man of studious and quiet habits. I am not strong\n          enough yet to stand much noise or excitement. I had enough of both in\n          Afghanistan to last me for the remainder of my natural existence. How\n          could I meet this friend of yours?”\n        </p>\n\n        <p class=\"p\">\n          “He is sure to be at the laboratory,” returned my companion. “He\n          either avoids the place for weeks, or else he works there from morning\n          to night. If you like, we shall drive round together after luncheon.”\n        </p>\n\n        <p class=\"p\">\n          “Certainly,” I answered, and the conversation drifted away into other\n          channels.\n        </p>\n\n        <p class=\"p\">\n          As we made our way to the hospital after leaving the Holborn, Stamford\n          gave me a few more particulars about the gentleman whom I proposed to\n          take as a fellow-lodger.\n        </p>\n\n        <p class=\"p\">\n          “You mustn’t blame me if you don’t get on with him,” he said; “I know\n          nothing more of him than I have learned from meeting him occasionally\n          in the laboratory. You proposed this arrangement, so you must not hold\n          me responsible.”\n        </p>\n\n        <p class=\"p\">\n          “If we don’t get on it will be easy to part company,” I answered. “It\n          seems to me, Stamford,” I added, looking hard at my companion, “that\n          you have some reason for washing your hands of the matter. Is this\n          fellow’s temper so formidable, or what is it? Don’t be mealy-mouthed\n          about it.”\n        </p>\n\n        <p class=\"p\">\n          “It is not easy to express the inexpressible,” he answered with a\n          laugh. “Holmes is a little too scientific for my tastes — it\n          approaches to cold-bloodedness. I could imagine his giving a friend a\n          little pinch of the latest vegetable alkaloid, not out of malevolence,\n          you understand, but simply out of a spirit of inquiry in order to have\n          an accurate idea of the effects. To do him justice, I think that he\n          would take it himself with the same readiness. He appears to have a\n          passion for definite and exact knowledge.”\n        </p>\n\n        <p class=\"p\">“Very right too.”</p>\n\n        <p class=\"p\">\n          “Yes, but it may be pushed to excess. When it comes to beating the\n          subjects in the dissecting-rooms with a stick, it is certainly taking\n          rather a bizarre shape.”\n        </p>\n\n        <p class=\"p\">“Beating the subjects!”</p>\n\n        <p class=\"p\">\n          “Yes, to verify how far bruises may be produced after death. I saw him\n          at it with my own eyes.”\n        </p>\n\n        <p class=\"p\">“And yet you say he is not a medical student?”</p>\n\n        <p class=\"p\">\n          “No. Heaven knows what the objects of his studies are. But here we\n          are, and you must form your own impressions about him.” As he spoke,\n          we turned down a narrow lane and passed through a small side-door,\n          which opened into a wing of the great hospital. It was familiar ground\n          to me, and I needed no guiding as we ascended the bleak stone\n          staircase and made our way down the long corridor with its vista of\n          whitewashed wall and dun-coloured doors. Near the further end a low\n          arched passage branched away from it and led to the chemical\n          laboratory.\n        </p>\n\n        <p class=\"p\">\n          This was a lofty chamber, lined and littered with countless bottles.\n          Broad, low tables were scattered about, which bristled with retorts,\n          test-tubes, and little Bunsen lamps, with their blue flickering\n          flames. There was only one student in the room, who was bending over a\n          distant table absorbed in his work. At the sound of our steps he\n          glanced round and sprang to his feet with a cry of pleasure. “I’ve\n          found it! I’ve found it,” he shouted to my companion, running towards\n          us with a test-tube in his hand. “I have found a re-agent which is\n          precipitated by haemoglobin, and by nothing else.” Had he discovered a\n          gold mine, greater delight could not have shone upon his features.\n        </p>\n\n        <p class=\"p\">\n          “Dr. Watson, Mr. Sherlock Holmes,” said Stamford, introducing us.\n        </p>\n\n        <p class=\"p\">\n          “How are you?” he said cordially, gripping my hand with a strength for\n          which I should hardly have given him credit. “You have been in\n          Afghanistan, I perceive.”\n        </p>\n\n        <p class=\"p\">\n          “How on earth did you know that?” I asked in astonishment.\n        </p>\n\n        <p class=\"p\">\n          “Never mind,” said he, chuckling to himself. “The question now is\n          about haemoglobin. No doubt you see the significance of this discovery\n          of mine?”\n        </p>\n\n        <p class=\"p\">\n          “It is interesting, chemically, no doubt,” I answered, “but\n          practically —”\n        </p>\n\n        <p class=\"p\">\n          “Why, man, it is the most practical medico-legal discovery for years.\n          Don’t you see that it gives us an infallible test for blood stains?\n          Come over here now!” He seized me by the coat-sleeve in his eagerness,\n          and drew me over to the table at which he had been working. “Let us\n          have some fresh blood,” he said, digging a long bodkin into his\n          finger, and drawing off the resulting drop of blood in a chemical\n          pipette. “Now, I add this small quantity of blood to a litre of water.\n          You perceive that the resulting mixture has the appearance of pure\n          water. The proportion of blood cannot be more than one in a million. I\n          have no doubt, however, that we shall be able to obtain the\n          characteristic reaction.” As he spoke, he threw into the vessel a few\n          white crystals, and then added some drops of a transparent fluid. In\n          an instant the contents assumed a dull mahogany colour, and a brownish\n          dust was precipitated to the bottom of the glass jar.\n        </p>\n\n        <p class=\"p\">\n          “Ha! ha!” he cried, clapping his hands, and looking as delighted as a\n          child with a new toy. “What do you think of that?”\n        </p>\n\n        <p class=\"p\">“It seems to be a very delicate test,” I remarked.</p>\n\n        <p class=\"p\">\n          “Beautiful! beautiful! The old guaiacum test was very clumsy and\n          uncertain. So is the microscopic examination for blood corpuscles. The\n          latter is valueless if the stains are a few hours old. Now, this\n          appears to act as well whether the blood is old or new. Had this test\n          been invented, there are hundreds of men now walking the earth who\n          would long ago have paid the penalty of their crimes.”\n        </p>\n\n        <p class=\"p\">“Indeed!” I murmured.</p>\n\n        <p class=\"p\">\n          “Criminal cases are continually hinging upon that one point. A man is\n          suspected of a crime months perhaps after it has been committed. His\n          linen or clothes are examined, and brownish stains discovered upon\n          them. Are they blood stains, or mud stains, or rust stains, or fruit\n          stains, or what are they? That is a question which has puzzled many an\n          expert, and why? Because there was no reliable test. Now we have the\n          Sherlock Holmes test, and there will no longer be any difficulty.”\n        </p>\n\n        <p class=\"p\">\n          His eyes fairly glittered as he spoke, and he put his hand over his\n          heart and bowed as if to some applauding crowd conjured up by his\n          imagination.\n        </p>\n\n        <p class=\"p\">\n          “You are to be congratulated,” I remarked, considerably surprised at\n          his enthusiasm.\n        </p>\n\n        <p class=\"p\">\n          “There was the case of Von Bischoff at Frankfort last year. He would\n          certainly have been hung had this test been in existence. Then there\n          was Mason of Bradford, and the notorious Muller, and Lefevre of\n          Montpellier, and Samson of new Orleans. I could name a score of cases\n          in which it would have been decisive.”\n        </p>\n\n        <p class=\"p\">\n          “You seem to be a walking calendar of crime,” said Stamford with a\n          laugh. “You might start a paper on those lines. Call it the ‘Police\n          News of the Past.’”\n        </p>\n\n        <p class=\"p\">\n          “Very interesting reading it might be made, too,” remarked Sherlock\n          Holmes, sticking a small piece of plaster over the prick on his\n          finger. “I have to be careful,” he continued, turning to me with a\n          smile, “for I dabble with poisons a good deal.” He held out his hand\n          as he spoke, and I noticed that it was all mottled over with similar\n          pieces of plaster, and discoloured with strong acids.\n        </p>\n\n        <p class=\"p\">\n          “We came here on business,” said Stamford, sitting down on a high\n          three-legged stool, and pushing another one in my direction with his\n          foot. “My friend here wants to take diggings, and as you were\n          complaining that you could get no one to go halves with you, I thought\n          that I had better bring you together.”\n        </p>\n\n        <p class=\"p\">\n          Sherlock Holmes seemed delighted at the idea of sharing his rooms with\n          me. “I have my eye on a suite in Baker Street,” he said, “which would\n          suit us down to the ground. You don’t mind the smell of strong\n          tobacco, I hope?”\n        </p>\n\n        <p class=\"p\">“I always smoke ‘ship’s’ myself,” I answered.</p>\n\n        <p class=\"p\">\n          “That’s good enough. I generally have chemicals about, and\n          occasionally do experiments. Would that annoy you?”\n        </p>\n\n        <p class=\"p\">“By no means.”</p>\n\n        <p class=\"p\">\n          “Let me see — what are my other shortcomings? I get in the dumps at\n          times, and don’t open my mouth for days on end. You must not think I\n          am sulky when I do that. Just let me alone, and I’ll soon be right.\n          What have you to confess now? It’s just as well for two fellows to\n          know the worst of one another before they begin to live together.”\n        </p>\n\n        <p class=\"p\">\n          I laughed at this cross-examination. “I keep a bull pup,” I said, “and\n          I object to rows because my nerves are shaken, and I get up at all\n          sorts of ungodly hours, and I am extremely lazy. I have another set of\n          vices when I’m well, but those are the principal ones at present.”\n        </p>\n\n        <p class=\"p\">\n          “Do you include violin-playing in your category of rows?” he asked,\n          anxiously.\n        </p>\n\n        <p class=\"p\">\n          “It depends on the player,” I answered. “A well-played violin is a\n          treat for the gods — a badly-played one —”\n        </p>\n\n        <p class=\"p\">\n          “Oh, that’s all right,” he cried, with a merry laugh. “I think we may\n          consider the thing as settled — that is, if the rooms are agreeable to\n          you.”\n        </p>\n\n        <p class=\"p\">“When shall we see them?”</p>\n\n        <p class=\"p\">\n          “Call for me here at noon to-morrow, and we’ll go together and settle\n          everything,” he answered.\n        </p>\n\n        <p class=\"p\">“All right — noon exactly,” said I, shaking his hand.</p>\n\n        <p class=\"p\">\n          We left him working among his chemicals, and we walked together\n          towards my hotel.\n        </p>\n\n        <p class=\"p\">\n          “By the way,” I asked suddenly, stopping and turning upon Stamford,\n          “how the deuce did he know that I had come from Afghanistan?”\n        </p>\n\n        <p class=\"p\">\n          My companion smiled an enigmatical smile. “That’s just his little\n          peculiarity,” he said. “A good many people have wanted to know how he\n          finds things out.”\n        </p>\n\n        <p class=\"p\">\n          “Oh! a mystery is it?” I cried, rubbing my hands. “This is very\n          piquant. I am much obliged to you for bringing us together. ‘The\n          proper study of mankind is man,’ you know.”\n        </p>\n\n        <p class=\"p\">\n          “You must study him, then,” Stamford said, as he bade me good-bye.\n          “You’ll find him a knotty problem, though. I’ll wager he learns more\n          about you than you about him. Good-bye.”\n        </p>\n\n        <p class=\"p\">\n          “Good-bye,” I answered, and strolled on to my hotel, considerably\n          interested in my new acquaintance.\n        </p>"
    },
    {
      "role": "assistant",
      "content": "{\n{\"name\": \"Watson\",\n\"occurence\": [144, 250, 259, 323, 331, 381, 410, 422, 425, 452, 487, 551, 554, 573, 582, 643, 683, 700]\n},\n{\"name\": \"Holmes\",\n\"occurence\": [427, 431, 440, 447, 454, 520, 547, 564, 587, 635, 703, 728, 777, 839, 856, 861, 909, 916, 950, 973, 978, 992, 1025, 1103, 1120, 1125, 1146, 1163, 1168, 1196, 1201, 1220, 1275, 1293, 1306, 1328, 1376, 1412, 1416, 1429]\n},\n{\"name\": \"Stamford\",\n\"occurence\": [222, 260, 280, 338, 341, 885, 1033, 1121, 1143, 1210, 1257, 1354, 1377]\n},\n{\"name\": \"Murray\",\n\"occurence\": [26]\n},\n{\"name\": \"Candahar\",\n\"occurence\": [66]\n}\n}\nTotal length of the chapter: 16114"
    }
  ],
  temperature: 1,
  max_tokens: 320,
  top_p: 1,
  frequency_penalty: 0,
  presence_penalty: 0,
});
